<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      html,
      body {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <main id="parkingViewElement" class="relative z-10 w-[297px] h-[210px]">
      <canvas id="canvasElement" class="absolute z-0"></canvas>
      <div class="parkingGroup" id="parkingGroupSinistra">
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
      </div>
      <div class="parkingGroup" id="parkingGroupAlto">
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
      </div>
      <div class="parkingGroup" id="parkingGroupDestra">
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
        <div class="parkingItem"></div>
      </div>
    </main>
    <script>
      const parkingViewElement = document.getElementById("parkingViewElement");
      const canvasElement = document.getElementById("canvasElement");

      const parkingGroups = {
        sinistra: document.getElementById("parkingGroupSinistra"),
        alto: document.getElementById("parkingGroupAlto"),
        destra: document.getElementById("parkingGroupDestra"),
      };
      const parkingItems = {
        all: document.querySelectorAll(".parkingItem"),
      }

      Object.entries(parkingGroups).forEach(([name, thisParkingGroup]) => {
        parkingItems[name] = thisParkingGroup.querySelectorAll(".parkingItem");
      })

      console.log(parkingItems)

      const parkingItemConfig = {
        parkingSlotSize: {
          width: 30,
          height: 60,
        },
        get spessoreBordo() {
          return Math.min(this.parkingSlotSize.height, this.parkingSlotSize.width) / 10;
        },
      };

      parkingItems.forEach((thisParkingItemElement) => {
        const classString = `shadow-inner border-[length:${parkingItemConfig.spessoreBordo}px]`;
        const spreadString = classString.split(" ");
        thisParkingItemElement.classList.add(...spreadString);
      });

      parkingGroups.sinistra.querySelectorAll(".parkingItem").forEach((thisParkingItemElement) => {
        const classString = ``;
        const spreadString = classString.split(" ");
        thisParkingItemElement.classList.add()
      })

      //   parkingItems.setAttribute("style", `${parkingItems.getAttribute("style")}`);

      const ctx = canvasElement.getContext("2d", {
        alpha: false,
        desynchronized: true,
        willReadFrequently: true,
      });

      navigator.mediaDevices
        .getUserMedia({
          video: {
            facingMode: "environment",
            aspectRatio: 297 / 210,
          },
        })
        .then(async (stream) => {
          const videoTrack = stream.getVideoTracks()[0];
          if (!window.MediaStreamTrackProcessor) {
            document.body.textContent =
              "Aggiorna il browser o utilizza un altro browser. `window.MediaStreamTrackProcessor` non Ã¨ disponibile. per dettagli vedi: https://caniuse.com/?search=mediastreamtrackprocessor";
            return;
          }
          const processor = new MediaStreamTrackProcessor({ track: videoTrack });
          const reader = processor.readable.getReader();

          canvasElement.width = parkingViewElement.clientWidth;
          canvasElement.height = parkingViewElement.clientHeight;

          drawThisFrame();

          async function drawThisFrame() {
            const { value: frame, done } = await reader.read();
            if (done) return;
            ctx.drawImage(frame, 0, 0, canvasElement.width, canvasElement.height);
            frame.close();

            drawThisFrame();
          }
        });
    </script>
  </body>
</html>
