<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://docs.opencv.org/4.11.0/opencv.js"></script>
  </head>
  <body class="p-2 grid gap-4">
    <video id="videoElement" autoplay></video>
    <canvas id="canvasElement" class="outline"></canvas>
    <script>
      cv.then((cv2) => {
        const videoElement = document.getElementById("videoElement");
        const canvasElement = document.getElementById("canvasElement");
        const ctx = canvasElement.getContext("2d");
        const DIMENSIONS = {
          W: 300,
          H: 300,
        };
        const FPS = 60;
        [videoElement, canvasElement].forEach((thisHtmlElement) => {
          thisHtmlElement.width = DIMENSIONS.W;
          thisHtmlElement.height = DIMENSIONS.H;
        });
        navigator.mediaDevices
          .getUserMedia({
            video: {
              facingMode: "environment",
              width: DIMENSIONS.W,
              height: DIMENSIONS.H,
            },
          })
          .then((stream) => {
            videoElement.srcObject = stream;
            let i = 0;
            setInterval(() => {
              console.log(i++);
              ctx.drawImage(videoElement, 0, 0, DIMENSIONS.W, DIMENSIONS.H);
              let src = cv2.imread(canvasElement);
              let gray = new cv2.Mat();
              let binary = new cv2.Mat();
              cv2.cvtColor(src, gray, cv2.COLOR_RGBA2GRAY);
              cv2.threshold(gray, binary, 120, 255, cv2.TRESH_BINARY);
              cv2.imshow(canvasElement, binary);
              
              [src, gray, binary].forEach(itemToDelete => itemToDelete.delete());

              //   console.log(src)
            }, 1000 / FPS);
          })
          .catch((err) => console.error);
      });
    </script>
  </body>
</html>
